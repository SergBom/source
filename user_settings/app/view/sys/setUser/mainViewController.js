/*
 * File: app/view/sys/setUser/mainViewController.js
 *
 * This file was generated by Sencha Architect version 3.5.1.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Portal.view.sys.setUser.mainViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.syssetusermain',

    onHiddenfieldChange: function(field, newValue, oldValue, eOpts) {
        this.getReferences().userImage.setSrc(newValue);
    },

    onSettingUserBtnSaveClick: function(button, e, eOpts) {
        this.getView().submit({
            clientValidation: true,
            params: {
                status: 'save'
            },
            success: function(form, action) {
                form.setValues({
                    userImageSrc: action.result.data.userImageSrc
                });
                Ext.ux.Alert.info('!!!','Записали ;)');
            },
            failure: function(form, action) {
                Portal.util.Util.handleFormFailure(action);
            }
        });
    },

    onBtnSysSetUserSetFotoClick: function(button, e, eOpts) {

    },

    onSettingUserAfterRender: function(component, eOpts) {
        var AccessEdit = Portal.util.Util.appAccessEdit(this.getView().xtype);
        var v=this.getView(),vm=this.getViewModel(),r=v.getReferences(),
            stA=vm.getStore('address'),
            stR=vm.getStore('orgs'),
            stO=vm.getStore('otdels'),
            stD=vm.getStore('dolzhnost');
        stR.load({
            scope: this,
            callback: function(records, operation, success) {
                var e=Ext.JSON.decode(operation.getResponse().responseText).org_id;
                //console.log(e);
                stO.proxy.extraParams = {org_id:r.org_id.getValue()};
                stD.proxy.extraParams = {org_id:r.org_id.getValue()};
            }
        });
        stA.load();

        v.load({
            params: {
                status: 'load'
            },
            success: function(form, action) {
                Ext.ux.Alert.info('!!!','Добро пожаловать!');
                if(r.org_id.getValue()>0){
                    r.org_id.setDisabled(true);
                    r.otdel_id.setDisabled(false);
                    r.dolzhnost_id.setDisabled(false);
                }
            }
        });
    }

});
