/*
 * File: app/view/sys/setUser/main.js
 *
 * This file was generated by Sencha Architect version 3.5.1.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Portal.view.sys.setUser.main', {
    extend: 'Ext.form.Panel',
    alias: 'widget.sys_settinguser',

    requires: [
        'Portal.view.sys.setUser.mainViewModel',
        'Portal.view.sys.setUser.mainViewController',
        'Ext.form.field.Hidden',
        'Ext.Img',
        'Ext.form.FieldContainer',
        'Ext.form.FieldSet',
        'Ext.form.field.Display',
        'Ext.toolbar.Toolbar',
        'Ext.button.Button',
        'Ext.toolbar.Separator',
        'Ext.form.field.Checkbox',
        'Ext.form.field.ComboBox'
    ],

    controller: 'syssetusermain',
    viewModel: {
        type: 'syssetusermain'
    },
    reference: 'settingUser',
    height: 480,
    id: 'settingUser',
    itemId: 'settingUser',
    width: 594,
    layout: 'border',
    url: 'data/sys/setUser/settingUser.php',
    defaultListenerScope: true,

    items: [
        {
            xtype: 'container',
            region: 'north',
            height: 141,
            layout: {
                type: 'hbox',
                align: 'middle'
            },
            items: [
                {
                    xtype: 'hiddenfield',
                    flex: 1,
                    fieldLabel: 'Label',
                    name: 'userImageSrc',
                    listeners: {
                        change: {
                            fn: 'onHiddenfieldChange',
                            scope: 'controller'
                        }
                    }
                },
                {
                    xtype: 'image',
                    formBind: true,
                    reference: 'userImage',
                    height: 140,
                    maxHeight: 140,
                    maxWidth: 140,
                    minHeight: 140,
                    minWidth: 140,
                    width: 140
                },
                {
                    xtype: 'fieldcontainer',
                    flex: 1,
                    height: 120,
                    width: 400,
                    items: [
                        {
                            xtype: 'fieldset',
                            frame: false,
                            title: 'Персональные данные',
                            items: [
                                {
                                    xtype: 'textfield',
                                    validator: function(value) {
                                        var tn = value.replace(/[А-Я]+/i,''),
                                            errMsg = "Должны быть только Русские буквы";
                                        return (tn.length === 0) ? true : errMsg;
                                    },
                                    anchor: '100%',
                                    fieldLabel: 'Фамилия',
                                    name: 'userFm',
                                    fieldCls: 'fixed',
                                    allowBlank: false
                                },
                                {
                                    xtype: 'textfield',
                                    validator: function(value) {
                                        var tn = value.replace(/[А-Я]+/i,''),
                                            errMsg = "Должны быть только Русские буквы";
                                        return (tn.length === 0) ? true : errMsg;
                                    },
                                    anchor: '100%',
                                    fieldLabel: 'Имя',
                                    name: 'userIm',
                                    fieldCls: 'fixed'
                                },
                                {
                                    xtype: 'textfield',
                                    validator: function(value) {
                                        var tn = value.replace(/[А-Я]+/i,''),
                                            errMsg = "Должны быть только Русские буквы";
                                        return (tn.length === 0) ? true : errMsg;
                                    },
                                    anchor: '100%',
                                    fieldLabel: 'Отчество',
                                    name: 'userOt',
                                    fieldCls: 'fixed'
                                }
                            ]
                        },
                        {
                            xtype: 'displayfield',
                            value: 'Обратите внимание! Данная информация записывается не только на портале, но и в домене!',
                            fieldCls: 'label-warning'
                        }
                    ]
                }
            ]
        },
        {
            xtype: 'fieldset',
            region: 'center',
            title: 'Служебная информация',
            layout: {
                type: 'hbox',
                align: 'stretch'
            },
            items: [
                {
                    xtype: 'fieldset',
                    width: 287,
                    items: [
                        {
                            xtype: 'textfield',
                            fieldLabel: 'Телефон городской',
                            name: 'tel1',
                            enforceMaxLength: true,
                            maxLength: 18,
                            regex: /^(\(?\d{3}\)?[\- ]?)?[\d\- ]{7,10}$/,
                            regexText: 'Формат: (815)2 45-55-55 или (815)33 5-55-55 или 921 222 22 22'
                        },
                        {
                            xtype: 'textfield',
                            fieldLabel: 'Телефон мобильный',
                            name: 'tel2',
                            inputType: 'tel',
                            enforceMaxLength: true,
                            maxLength: 18,
                            regex: /^(\(?\d{3}\)?[\- ]?)?[\d\- ]{7,10}$/,
                            regexText: 'Формат: (911)555-55-55 или 921 222 22 22'
                        },
                        {
                            xtype: 'textfield',
                            fieldLabel: 'Телефон IP',
                            name: 'telIP',
                            enforceMaxLength: true,
                            maxLength: 4,
                            minLength: 4,
                            regex: /[0-9]{4}/
                        },
                        {
                            xtype: 'textfield',
                            fieldLabel: 'e-mail',
                            name: 'email',
                            inputType: 'email',
                            vtype: 'email'
                        },
                        {
                            xtype: 'checkboxfield',
                            anchor: '100%',
                            name: 'say',
                            boxLabel: 'Отображать в телефонном справочнике'
                        }
                    ]
                },
                {
                    xtype: 'fieldset',
                    flex: 1,
                    padding: 5,
                    layout: {
                        type: 'vbox',
                        align: 'stretch'
                    },
                    items: [
                        {
                            xtype: 'combobox',
                            reference: 'org_id',
                            fieldLabel: 'Организация',
                            name: 'org_id',
                            editable: false,
                            autoLoadOnValue: true,
                            displayField: 'name',
                            valueField: 'id',
                            bind: {
                                store: '{orgs}'
                            },
                            listeners: {
                                change: 'onComboboxChange'
                            }
                        },
                        {
                            xtype: 'combobox',
                            reference: 'otdel_id',
                            disabled: true,
                            fieldLabel: 'Отдел',
                            name: 'otdel_id',
                            editable: false,
                            autoLoadOnValue: true,
                            displayField: 'name',
                            valueField: 'id',
                            bind: {
                                store: '{otdels}'
                            },
                            listeners: {
                                change: 'onComboboxChange1'
                            }
                        },
                        {
                            xtype: 'combobox',
                            reference: 'dolzhnost_id',
                            disabled: true,
                            fieldLabel: 'Должность',
                            name: 'dolzhnost_id',
                            editable: false,
                            autoLoadOnValue: true,
                            displayField: 'name',
                            valueField: 'id',
                            bind: {
                                store: '{dolzhnost}'
                            }
                        },
                        {
                            xtype: 'hiddenfield',
                            fieldLabel: 'Label',
                            name: 'otdel_old'
                        },
                        {
                            xtype: 'fieldcontainer',
                            fieldLabel: 'Адрес',
                            layout: {
                                type: 'hbox',
                                align: 'stretch',
                                pack: 'center'
                            },
                            items: [
                                {
                                    xtype: 'combobox',
                                    flex: 1,
                                    reference: 'address_id',
                                    name: 'address_id',
                                    editable: false,
                                    autoLoadOnValue: true,
                                    displayField: 'name',
                                    valueField: 'id',
                                    bind: {
                                        store: '{address}'
                                    }
                                },
                                {
                                    xtype: 'button',
                                    iconCls: 'icon-add',
                                    text: 'Добавить'
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            xtype: 'fieldset',
            region: 'south',
            height: 110,
            collapsed: true,
            collapsible: true,
            title: 'Портальные данные',
            layout: {
                type: 'hbox',
                align: 'stretch'
            },
            items: [
                {
                    xtype: 'fieldcontainer',
                    height: 120,
                    width: 208,
                    items: [
                        {
                            xtype: 'displayfield',
                            fieldLabel: 'id',
                            name: 'id'
                        },
                        {
                            xtype: 'displayfield',
                            fieldLabel: 'логин',
                            name: 'username'
                        }
                    ]
                },
                {
                    xtype: 'fieldcontainer',
                    flex: 1,
                    height: 120,
                    width: 337,
                    layout: 'form',
                    items: [
                        {
                            xtype: 'displayfield',
                            fieldLabel: 'Дата регистрации',
                            labelWidth: 150,
                            name: 'registerDate'
                        },
                        {
                            xtype: 'displayfield',
                            fieldLabel: 'Дата последнего входа',
                            labelWidth: 150,
                            name: 'lastvisitDate'
                        },
                        {
                            xtype: 'displayfield',
                            labelPad: 0,
                            labelWidth: 0,
                            name: 'dn'
                        }
                    ]
                }
            ]
        }
    ],
    dockedItems: [
        {
            xtype: 'toolbar',
            dock: 'top',
            items: [
                {
                    xtype: 'button',
                    formBind: true,
                    id: 'settingUserBtnSave',
                    iconCls: 'dialog-save',
                    text: 'Сохранить',
                    listeners: {
                        click: {
                            fn: 'onSettingUserBtnSaveClick',
                            scope: 'controller'
                        }
                    }
                },
                {
                    xtype: 'tbseparator'
                },
                {
                    xtype: 'button',
                    disabled: true,
                    iconCls: 'icon-key',
                    text: 'Сменить пароль'
                },
                {
                    xtype: 'tbseparator'
                },
                {
                    xtype: 'button',
                    id: 'btnSysSetUserSetFoto',
                    iconCls: 'icon-image',
                    text: 'Изменить фотографию',
                    listeners: {
                        click: {
                            fn: 'onBtnSysSetUserSetFotoClick',
                            scope: 'controller'
                        }
                    }
                }
            ]
        }
    ],
    listeners: {
        afterrender: {
            fn: 'onSettingUserAfterRender',
            scope: 'controller'
        }
    },

    onComboboxChange: function(field, newValue, oldValue, eOpts) {
        var vm=this.getViewModel(),
            so=vm.getStore('otdels'),
            sd=vm.getStore('dolzhnost'),
            r=this.getReferences();
        if(newValue>0){
            r.otdel_id.setDisabled(false);
            r.dolzhnost_id.setDisabled(false);
        }else{
            r.otdel_id.setDisabled(true);
            r.dolzhnost_id.setDisabled(true);
        }
        so.proxy.extraParams = {org_id:newValue};
        sd.proxy.extraParams = {org_id:newValue};
        so.load();
        sd.load();
    },

    onComboboxChange1: function(field, newValue, oldValue, eOpts) {
        //console.log(oldValue);
        this.getForm().setValues({
            otdel_old:oldValue
        });
    }

});